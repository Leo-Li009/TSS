(()=>{var e={113:(e,t,n)=>{"use strict";let o;n.d(t,{uZ:()=>l}),e=n.hmd(e);const r=new Array(128).fill(void 0);r.push(void 0,null,!0,!1);let i=r.length;function a(e){const t=function(e){return r[e]}(e);return function(e){e<132||(r[e]=i,i=e)}(e),t}new TextEncoder("utf-8").encodeInto;let s=null;function c(){return null!==s&&0!==s.byteLength||(s=new Int32Array(o.memory.buffer)),s}function d(e){i===r.length&&r.push(r.length+1);const t=i;return i=r[t],r[t]=e,t}new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}).decode();class l{static __wrap(e){const t=Object.create(l.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_keygenerator_free(e)}constructor(e,t){try{const i=o.__wbindgen_add_to_stack_pointer(-16);o.keygenerator_new(i,d(e),d(t));var n=c()[i/4+0],r=c()[i/4+1];if(c()[i/4+2])throw a(r);return l.__wrap(n)}finally{o.__wbindgen_add_to_stack_pointer(16)}}handleIncoming(e){try{const n=o.__wbindgen_add_to_stack_pointer(-16);o.keygenerator_handleIncoming(n,this.ptr,d(e));var t=c()[n/4+0];if(c()[n/4+1])throw a(t)}finally{o.__wbindgen_add_to_stack_pointer(16)}}proceed(){try{const n=o.__wbindgen_add_to_stack_pointer(-16);o.keygenerator_proceed(n,this.ptr);var e=c()[n/4+0],t=c()[n/4+1];if(c()[n/4+2])throw a(t);return a(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}create(){try{const n=o.__wbindgen_add_to_stack_pointer(-16);o.keygenerator_create(n,this.ptr);var e=c()[n/4+0],t=c()[n/4+1];if(c()[n/4+2])throw a(t);return a(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}}},65:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=65,e.exports=t}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={id:o,loaded:!1,exports:{}};return e[o](i,i.exports,n),i.loaded=!0,i.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(113);const t="https://rpc.echooo.link:9222/rooms/",o="https://rpc.echooo.link:9222/uuid/";async function r(e){const t=e.getReader();let n="";try{for(;;){const{value:e,done:o}=await t.read();if(o)break;n+=(new TextDecoder).decode(e)}}catch(e){console.error("Error reading stream:",e)}finally{t.releaseLock()}return n}async function i(e,t,n){await fetch(e+n+"/broadcast-c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t[1][0])})}async function a(e,t,n){await fetch(e+n+"/broadcast-c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t[1][1])}),await fetch(e+n+"/broadcast-c",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t[1][0])})}async function s(e){return new Promise((t=>{setTimeout(t,e)}))}function c(e,t,n){let o={side:e.toString(),username:n,key:JSON.stringify(t)};fetch("https://rpc.echooo.link:9222//redis/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return!0})).then((e=>(console.log("redis set key finish"),!0))).catch((e=>{console.log("There was an error!",e)}))}addEventListener("message",(async n=>{console.time("keygen");let d=1;const l=Number(n.data.sideId),u=n.data.username;let p={number:l,uuid:"12333"};console.log("side_id",l),console.log("username",u),2==l?(d=function(e,t=0){let n=""!=t?t:Math.floor(1e3*Math.random()).toString(),o={room_id:n,username:e};return fetch("https://rpc.echooo.link:9222/keygen/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),n}(u),await async function(e,t){fetch(o+e+"/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}(p.uuid,d)):(await s(1e3),d=await async function(e){const t=await fetch(o+e+"/get",{method:"get",headers:{"Content-Type":"application/json"}}),n=await r(t.body);console.log(n);let i=JSON.parse(n);return JSON.parse(i[0])}(p.uuid));let h=new e.uZ({parties:3,threshold:1},p),f=h.proceed();await i(t,f,d),await async function(e,n,o,d,l){let u=1,p=Array(4),h=0,f=0;for(let e=0;e<4;e++){p[e]=Array(3);for(let t=0;t<3;t++)p[e][t]=!1}for(;;){const _=await fetch(e+o+"/getinfer",{method:"get",headers:{"Content-Type":"application/json"}}),y=await r(_.body);let g=JSON.parse(y);for(let e=0;e<g.length;e++){let r;try{r=JSON.parse(g[e])}catch(e){continue}if(null==r)continue;if(""==r)continue;if(r.round<u)continue;if(r.sender==d)continue;if(null!=r.receiver&&r.receiver!=d&&null!=r.receiver)continue;if(p[r.round-1][r.sender-1])continue;console.time("handleIncoming"),1==r.round&&3==r.sender&&console.time("round1"),n.handleIncoming(r);let s=n.proceed();if(p[r.round-1][r.sender-1]=!0,u=r.round,h++,u<4&&h+1==3)2==u?(console.log("round3"),await a(t,s,o),console.timeEnd("handleIncoming")):(await i(t,s,o),console.timeEnd("round1"),console.timeEnd("handleIncoming")),h=0;else if(4==u&&h+1==3){let e=n.create();return c(d,e,l),void console.log("s.address",e.address)}}if(await s(50),++f>=100){console.log("********Time out in trying*****!");break}}}(t,h,d,l,u),console.timeEnd("keygen")}))})()})();